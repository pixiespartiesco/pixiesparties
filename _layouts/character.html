<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/x-icon" href="/assets/img/logo.webp">
    <!-- Use the article's 'title' variable -->
    <title>{{ page.title }} | Pixie's Parties</title>    
	
	{% include scripts.html %} 
	<script type="application/ld+json">
		{% assign packages = site.data.packages.packages %}
		{% assign item_list_elements = "" %}
		{% for package in packages %}
		  {% capture offer_item %}
			{
			  "@type": "Offer",
			  "itemOffered": {
				"@type": "Service",
				"name": "{{ package.title | escape }}",
				"description": "{{ package.description | escape }} ({{ package.duration }} of entertainment). Features include: {{ package.features | map: 'detail' | join: ', ' | escape }}",
				"offers": {
				  "@type": "Offer",
				  "name": "{{ package.title | escape }} Price",
				  "price": "{{ package.price | escape }}",
				  "priceCurrency": "CAD"
				}
			  }
			}
		  {% endcapture %}
		  {% assign item_list_elements = item_list_elements | append: offer_item %}
		  {% unless forloop.last %}
			{% assign item_list_elements = item_list_elements | append: ", " %}
		  {% endunless %}
		{% endfor %}
		
		{% assign reviews = site.data.reviews %}
		{% assign total_rating = 0.0 %}
		{% assign review_count = reviews.size %}

		{% for review in reviews %}
		  {% assign total_rating = total_rating | plus: review.rating %}
		{% endfor %}

		{% if review_count > 0 %}
		  {% assign average_rating = total_rating | divided_by: review_count | round: 1 %}
		{% else %}
		  {% assign average_rating = 0 %}
		{% endif %}
	  {
		  "@context": "https://schema.org/",
		  "@type": "Service",
		  "serviceType": "Character Appearance",
		  "name": "{{ page.title }} Party Appearance",
		  "description": "{{ page.subtitle }}",
		  "image": "{{ site.url }}{{ page.img1 }}",
		  "provider": {
			"@type": "LocalBusiness",
			"name": "Pixie Parties"
		  },
		  "areaServed": "Calgary",
		  "hasOfferCatalog": {
			"@type": "OfferCatalog",
			"name": "Party Packages",
			"itemListElement": [
			  {{ item_list_elements }}
			]
		  },
		  "aggregateRating": {
			"@type": "AggregateRating",
			"ratingValue": "{{ average_rating }}",
			"bestRating": "5",
			"worstRating": "1",
			"ratingCount": "{{ review_count }}"
		  },
		  "review": [
			{% for review in reviews limit: 15 %}
			{
			  "@type": "Review",
			  "author": {
				"@type": "Person",
				"name": "{{ review.name }}"
			  },
			  "datePublished": "{{ review.date }}",
			  "reviewBody": "{{ review.text | strip_newlines | escape }}",
			  "reviewRating": {
				"@type": "Rating",
				"ratingValue": "{{ review.rating }}"
			  }
			}{% unless forloop.last %},{% endunless %}
			{% endfor %}
		  ]
		}
	</script>
</head>
<body class="bg-primary">
    {% include navbar.html %}

	<main class="container my-5">
        <div class="row">
            <div class="col-lg-9">
                <div class="bg-white text-secondary rounded p-3">
					<div class="article-body">
						{{ content }}
					</div>					
					{% include packages-mini.html %}
				</div>
                <div class="mt-5">
                    <a href="/characters/" class="btn btn-secondary">‚Üê Back to Characters</a>
                </div>
            </div>
			
            <div class="col-lg-3 d-none d-lg-block">
                <div class="sticky-top sticky-sidebar bg-white p-4 rounded-3 shadow-sm border border-quaternary">
                    <h3 class="fw-bold text-secondary mb-3">Characters</h3>
                    
                    <ul class="list-unstyled">
                        {% for c in site.characters %}                            
							<li class="mb-3 border-bottom pb-2">
								<a href="{{ c.url | relative_url }}" class="text-decoration-none fw-medium">
									{{ c.title | truncatewords: 8 }}
								</a>
							</li>
                        {% endfor %}
                    </ul>
                    
                    <a href="/characters/" class="btn btn-sm btn-secondary w-100 mt-2">View All Characters</a>
                </div>
            </div>            
        </div>
    </main>
	
    {% include footer.html %}
  </div>
</div>
    
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>